<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿ≤Ÿàÿ≤Ÿà | ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿßÿµÿ©</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ff4d6d;
            --primary-light: #ff758f;
            --primary-dark: #c9184a;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.15);
            --glass-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            --transition-smooth: cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a0f 50%, #0a0a0a 100%);
            font-family: 'Tajawal', sans-serif;
            height: 100vh;
            position: relative;
        }

        /* Canvas Background */
        #particles-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Ambient Glow Effects */
        .ambient-glow {
            position: fixed;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.4;
            pointer-events: none;
            z-index: 2;
            animation: pulse-glow 8s ease-in-out infinite;
        }

        .glow-1 {
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, var(--primary) 0%, transparent 70%);
            top: -200px;
            right: -200px;
            animation-delay: 0s;
        }

        .glow-2 {
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, #ff8fa3 0%, transparent 70%);
            bottom: -100px;
            left: -100px;
            animation-delay: -4s;
        }

        @keyframes pulse-glow {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.2); opacity: 0.5; }
        }

        /* Glass Container */
        .glass-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: var(--glass-bg);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            padding: 50px 60px;
            text-align: center;
            color: white;
            box-shadow: var(--glass-shadow),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.6s var(--transition-smooth);
            min-width: 400px;
            max-width: 90vw;
        }

        .glass-container.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .glass-container.exit {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.9) translateY(-30px);
        }

        /* Typography */
        h2 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #fff 0%, #ffccd5 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 40px rgba(255, 77, 109, 0.3);
            letter-spacing: -0.5px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 30px;
            font-weight: 300;
        }

        /* Buttons */
        .buttons-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            position: relative;
            min-height: 60px;
        }

        .btn {
            padding: 16px 40px;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.1rem;
            font-family: 'Tajawal', sans-serif;
            transition: all 0.3s var(--transition-smooth);
            position: relative;
            overflow: hidden;
            min-width: 120px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-yes {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 10px 30px rgba(255, 77, 109, 0.4),
                        inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-yes:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 40px rgba(255, 77, 109, 0.5),
                        inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-no {
            background: rgba(255, 255, 255, 0.08);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.2s ease;
        }

        .btn-no:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .btn-no.escape-mode {
            position: absolute;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        /* Black Prompt Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal-box {
            background: linear-gradient(145deg, #0a0a0a 0%, #1a1a1a 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 40px 50px;
            text-align: center;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.8);
            transform: scale(0.9);
            transition: transform 0.4s var(--transition-smooth);
            max-width: 450px;
        }

        .modal-overlay.active .modal-box {
            transform: scale(1);
        }

        .modal-box h3 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #fff;
        }

        /* Video Container */
        .video-wrapper {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 500px;
            border-radius: 24px;
            overflow: hidden;
            border: 2px solid rgba(255, 77, 109, 0.3);
            box-shadow: 0 0 60px rgba(255, 77, 109, 0.2);
            z-index: 90;
            opacity: 0;
            visibility: hidden;
            transition: all 0.8s var(--transition-smooth);
        }

        .video-wrapper.active {
            opacity: 1;
            visibility: visible;
        }

        .video-wrapper video {
            width: 100%;
            display: block;
        }

        /* Typing Container */
        .typing-wrapper {
            position: fixed;
            bottom: 10%;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 700px;
            z-index: 110;
            opacity: 0;
            visibility: hidden;
            transition: all 0.6s var(--transition-smooth);
        }

        .typing-wrapper.active {
            opacity: 1;
            visibility: visible;
        }

        .typing-box {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 77, 109, 0.2);
            border-radius: 20px;
            padding: 30px 40px;
            text-align: center;
        }

        .typing-text {
            font-size: 1.6rem;
            font-weight: 600;
            color: #fff;
            line-height: 1.8;
            text-shadow: 0 0 20px rgba(255, 77, 109, 0.3);
        }

        .cursor {
            display: inline-block;
            width: 3px;
            height: 1.2em;
            background: var(--primary);
            margin-right: 5px;
            vertical-align: middle;
            animation: blink 0.8s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* Reset Button */
        .reset-btn {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            padding: 14px 28px;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            color: white;
            font-weight: 600;
            font-size: 0.95rem;
            font-family: 'Tajawal', sans-serif;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            transition: all 0.4s var(--transition-smooth);
            z-index: 220;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .reset-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(-50%) translateY(0) scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
        }

        .reset-btn.active {
            transform: translateX(-50%) translateY(0);
        }

        .reset-btn svg {
            width: 18px;
            height: 18px;
            transition: transform 0.4s ease;
        }

        .reset-btn:hover svg {
            transform: rotate(180deg);
        }

        /* Shake Animation */
        .shake {
            animation: shake 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translateX(-1px); }
            20%, 80% { transform: translateX(2px); }
            30%, 50%, 70% { transform: translateX(-4px); }
            40%, 60% { transform: translateX(4px); }
        }

        /* Heart Beat Animation */
        .heartbeat {
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            14% { transform: scale(1.1); }
            28% { transform: scale(1); }
            42% { transform: scale(1.1); }
            70% { transform: scale(1); }
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 150;
        }

        /* Progress Hearts */
        .progress-hearts {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            opacity: 0.6;
        }

        .progress-heart {
            width: 12px;
            height: 12px;
            background: var(--primary);
            transform: rotate(45deg);
            opacity: 0.3;
            transition: all 0.3s ease;
        }

        .progress-heart.active {
            opacity: 1;
            box-shadow: 0 0 10px var(--primary);
        }

        .progress-heart::before,
        .progress-heart::after {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--primary);
            border-radius: 50%;
        }

        .progress-heart::before { left: -6px; }
        .progress-heart::after { top: -6px; }

        /* Responsive */
        @media (max-width: 600px) {
            .glass-container {
                padding: 35px 30px;
                min-width: unset;
                width: 90%;
            }

            h2 {
                font-size: 1.8rem;
            }

            .btn {
                padding: 14px 30px;
                font-size: 1rem;
                min-width: 100px;
            }

            .typing-text {
                font-size: 1.2rem;
            }

            .modal-box {
                padding: 30px 25px;
                margin: 20px;
            }

            .modal-box h3 {
                font-size: 1.4rem;
            }
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            inset: 0;
            background: #0a0a0a;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.5s ease, visibility 0.5s;
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loading-heart {
            width: 60px;
            height: 60px;
            background: var(--primary);
            transform: rotate(45deg);
            animation: loading-pulse 1s ease-in-out infinite;
        }

        .loading-heart::before,
        .loading-heart::after {
            content: '';
            position: absolute;
            width: 60px;
            height: 60px;
            background: var(--primary);
            border-radius: 50%;
        }

        .loading-heart::before { left: -30px; }
        .loading-heart::after { top: -30px; }

        @keyframes loading-pulse {
            0%, 100% { transform: rotate(45deg) scale(1); }
            50% { transform: rotate(45deg) scale(1.2); }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loading">
        <div class="loading-heart"></div>
    </div>

    <!-- Ambient Glows -->
    <div class="ambient-glow glow-1"></div>
    <div class="ambient-glow glow-2"></div>

    <!-- Particles Canvas -->
    <canvas id="particles-canvas"></canvas>

    <!-- Confetti Canvas -->
    <canvas id="confetti-canvas"></canvas>

    <!-- Question 1: Identity -->
    <div id="q1-container" class="glass-container active">
        <div class="progress-hearts">
            <div class="progress-heart active"></div>
            <div class="progress-heart"></div>
            <div class="progress-heart"></div>
        </div>
        <h2>ÿ£ŸÜÿ™Ÿê ÿ≤ŸäŸÜÿ®ÿü üíï</h2>
        <p class="subtitle">ÿ£ÿ¨Ÿäÿ®Ÿä ÿ®ÿµÿØŸÇ Ÿäÿß ÿ≤Ÿàÿ≤Ÿà</p>
        <div class="buttons-container">
            <button class="btn btn-yes" onclick="app.handleQ1('yes')">
                <span>ÿ£Ÿäÿå ÿ£ŸÜÿß ÿ≤ŸäŸÜÿ®</span>
            </button>
            <button class="btn btn-no" id="q1-no" onclick="app.handleQ1('no')">
                <span>ŸÑÿß</span>
            </button>
        </div>
    </div>

    <!-- Question 2: Love -->
    <div id="q2-container" class="glass-container">
        <div class="progress-hearts">
            <div class="progress-heart active"></div>
            <div class="progress-heart active"></div>
            <div class="progress-heart"></div>
        </div>
        <h2 id="q2-title">ÿ™ÿ≠ÿ®ŸäŸÜŸäÿü ü•∫</h2>
        <p class="subtitle" id="q2-subtitle">ŸÅŸÉÿ±Ÿä ŸÉŸàŸäÿ≥ ŸÇÿ®ŸÑ ŸÖÿß ÿ™ÿ¨ÿßŸàÿ®Ÿä</p>
        <div class="buttons-container" id="q2-buttons">
            <button class="btn btn-yes" onclick="app.handleQ2('yes')">
                <span>ÿ£Ÿäÿå ÿ£ÿ≠ÿ®ŸÉ</span>
            </button>
            <button class="btn btn-no" id="q2-no" onclick="app.handleQ2('no')">
                <span>ŸÑÿß</span>
            </button>
        </div>
    </div>

    <!-- Question 3: Most Precious -->
    <div id="q3-container" class="glass-container">
        <div class="progress-hearts">
            <div class="progress-heart active"></div>
            <div class="progress-heart active"></div>
            <div class="progress-heart active"></div>
        </div>
        <h2 id="q3-title">ÿ£ÿ∫ŸÑŸâ Ÿàÿßÿ≠ÿØ ÿπŸÜÿØ⁄Ü.. üíé</h2>
        <p class="subtitle" id="q3-subtitle">ÿ£ŸÜÿß ŸàŸÑÿß ÿ∫Ÿäÿ±Ÿäÿü</p>
        <div class="buttons-container" id="q3-buttons">
            <button class="btn btn-yes" onclick="app.handleQ3('yes')">
                <span>ÿ£ŸÜÿ™Ÿé ÿ∑ÿ®ÿπÿßŸã</span>
            </button>
            <button class="btn btn-no" id="q3-no" onclick="app.handleQ3('no')">
                <span>ÿ∫Ÿäÿ±ŸÉ</span>
            </button>
        </div>
    </div>

    <!-- Black Modal -->
    <div id="black-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 id="modal-text">ŸäŸÑÿß ŸÑÿπÿØ ÿßÿ™Ÿà⁄ØŸÑŸä ÿ¥ÿ¨ÿßÿ®ÿ¨ ŸáŸÜÿßÿü ü§®</h3>
            <div class="buttons-container" style="margin-top: 25px;">
                <button class="btn btn-yes" onclick="app.handleModal('yes')">
                    <span>ÿ£Ÿäÿå ÿ≥ÿßŸÖÿ≠ŸäŸÜŸä</span>
                </button>
                <button class="btn btn-no" onclick="app.handleModal('no')">
                    <span>ŸÑÿßÿå ÿ£ÿ®ŸÇŸâ ŸáŸÜÿß</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Video Container -->
    <div id="video-container" class="video-wrapper">
        <video id="main-video" width="100%" loop>
            <source src="nod.mp4" type="video/mp4">
        </video>
    </div>

    <!-- Typing Container -->
    <div id="typing-wrapper" class="typing-wrapper">
        <div class="typing-box">
            <span class="typing-text" id="typing-text"></span>
            <span class="cursor">|</span>
        </div>
    </div>

    <!-- Reset Button -->
    <button id="reset-btn" class="reset-btn" onclick="app.reset()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
            <path d="M3 3v5h5"/>
        </svg>
        <span>ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÉŸÑ</span>
    </button>

    <script>
        // ==================== Particle System ====================
        class ParticleSystem {
            constructor() {
                this.canvas = document.getElementById('particles-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.particles = [];
                this.mode = 'float';
                this.hue = 340;
                this.frame = 0;
                this.mouse = { x: null, y: null };
                
                this.resize();
                this.init();
                this.bindEvents();
                this.animate();
            }

            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }

            init() {
                this.particles = [];
                const count = window.innerWidth < 600 ? 200 : 400;
                for (let i = 0; i < count; i++) {
                    this.particles.push(new Particle(i, this.canvas));
                }
            }

            bindEvents() {
                window.addEventListener('resize', () => {
                    this.resize();
                    this.init();
                });

                window.addEventListener('mousemove', (e) => {
                    this.mouse.x = e.clientX;
                    this.mouse.y = e.clientY;
                });

                window.addEventListener('mouseleave', () => {
                    this.mouse.x = null;
                    this.mouse.y = null;
                });
            }

            getHeartPosition(t, scale = 1) {
                return {
                    x: 16 * Math.pow(Math.sin(t), 3) * scale,
                    y: -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t)) * scale
                };
            }

            getInfinityPosition(t, scale = 1) {
                return {
                    x: 25 * Math.cos(t) * scale,
                    y: 15 * Math.sin(2*t) * scale / 2
                };
            }

            animate() {
                this.ctx.fillStyle = 'rgba(10, 10, 10, 0.1)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;

                this.particles.forEach((particle, i) => {
                    let targetX, targetY;
                    const t = (i / this.particles.length) * Math.PI * 2;

                    switch(this.mode) {
                        case 'heart':
                            const heart = this.getHeartPosition(t, 12);
                            targetX = centerX + heart.x;
                            targetY = centerY + heart.y;
                            break;
                        
                        case 'double-heart':
                            const offset = i < this.particles.length / 2 ? -100 : 100;
                            const dh = this.getHeartPosition(t * 2, 6);
                            targetX = centerX + offset + dh.x;
                            targetY = centerY + dh.y;
                            break;
                        
                        case 'infinity':
                            const inf = this.getInfinityPosition(t, 10);
                            targetX = centerX + inf.x;
                            targetY = centerY + inf.y;
                            break;
                        
                        case 'explode':
                            targetX = particle.x + (Math.random() - 0.5) * 10;
                            targetY = particle.y + (Math.random() - 0.5) * 10;
                            break;
                        
                        default:
                            targetX = particle.x + Math.sin(this.frame * 0.01 + i) * 0.5;
                            targetY = particle.y + Math.cos(this.frame * 0.01 + i) * 0.5;
                    }

                    // Mouse interaction
                    if (this.mouse.x && this.mouse.y && this.mode === 'float') {
                        const dx = this.mouse.x - particle.x;
                        const dy = this.mouse.y - particle.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        if (dist < 150) {
                            const force = (150 - dist) / 150;
                            particle.vx -= (dx / dist) * force * 0.5;
                            particle.vy -= (dy / dist) * force * 0.5;
                        }
                    }

                    // Apply velocity
                    if (this.mode !== 'float') {
                        particle.x += (targetX - particle.x) * 0.05;
                        particle.y += (targetY - particle.y) * 0.05;
                    } else {
                        particle.x += particle.vx;
                        particle.y += particle.vy;
                        particle.vx *= 0.98;
                        particle.vy *= 0.98;
                    }

                    // Boundary check
                    if (particle.x < 0 || particle.x > this.canvas.width) particle.vx *= -1;
                    if (particle.y < 0 || particle.y > this.canvas.height) particle.vy *= -1;

                    particle.draw(this.ctx, this.hue);
                });

                // Update hue
                if (this.mode === 'explode') {
                    this.hue = (this.hue + 10) % 360;
                } else {
                    this.hue = 340 + Math.sin(this.frame * 0.01) * 20;
                }

                this.frame++;
                requestAnimationFrame(() => this.animate());
            }

            setMode(mode) {
                this.mode = mode;
            }
        }

        class Particle {
            constructor(id, canvas) {
                this.id = id;
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
                this.size = Math.random() * 2 + 1;
                this.baseSize = this.size;
            }

            draw(ctx, hue) {
                const gradient = ctx.createRadialGradient(
                    this.x, this.y, 0,
                    this.x, this.y, this.size * 2
                );
                gradient.addColorStop(0, `hsla(${hue}, 100%, 70%, 1)`);
                gradient.addColorStop(1, `hsla(${hue}, 100%, 70%, 0)`);
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * 2, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // ==================== Confetti System ====================
        class ConfettiSystem {
            constructor() {
                this.canvas = document.getElementById('confetti-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.particles = [];
                this.active = false;
                
                this.resize();
                window.addEventListener('resize', () => this.resize());
            }

            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }

            explode() {
                this.active = true;
                for (let i = 0; i < 150; i++) {
                    this.particles.push(new ConfettiParticle(this.canvas));
                }
                this.animate();
                setTimeout(() => { this.active = false; }, 5000);
            }

            animate() {
                if (!this.active && this.particles.length === 0) return;

                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                this.particles = this.particles.filter(p => {
                    p.update();
                    p.draw(this.ctx);
                    return p.life > 0;
                });

                requestAnimationFrame(() => this.animate());
            }
        }

        class ConfettiParticle {
            constructor(canvas) {
                this.x = canvas.width / 2;
                this.y = canvas.height / 2;
                this.vx = (Math.random() - 0.5) * 20;
                this.vy = (Math.random() - 0.5) * 20 - 5;
                this.gravity = 0.3;
                this.friction = 0.98;
                this.size = Math.random() * 8 + 4;
                this.color = `hsl(${Math.random() * 60 + 320}, 100%, 60%)`;
                this.rotation = Math.random() * 360;
                this.rotationSpeed = (Math.random() - 0.5) * 10;
                this.life = 1;
                this.decay = 0.01;
            }

            update() {
                this.vx *= this.friction;
                this.vy *= this.friction;
                this.vy += this.gravity;
                this.x += this.vx;
                this.y += this.vy;
                this.rotation += this.rotationSpeed;
                this.life -= this.decay;
            }

            draw(ctx) {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate((this.rotation * Math.PI) / 180);
                ctx.fillStyle = this.color;
                ctx.globalAlpha = this.life;
                ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
                ctx.restore();
            }
        }

        // ==================== Main Application ====================
        class ZozoApp {
            constructor() {
                this.particles = new ParticleSystem();
                this.confetti = new ConfettiSystem();
                this.currentStage = 1;
                this.q2Attempts = 0;
                this.q3Attempts = 0;
                this.escapeMode = false;
                
                this.elements = {
                    q1: document.getElementById('q1-container'),
                    q2: document.getElementById('q2-container'),
                    q3: document.getElementById('q3-container'),
                    q2Title: document.getElementById('q2-title'),
                    q2Subtitle: document.getElementById('q2-subtitle'),
                    q3Title: document.getElementById('q3-title'),
                    q3Subtitle: document.getElementById('q3-subtitle'),
                    q2No: document.getElementById('q2-no'),
                    q3No: document.getElementById('q3-no'),
                    modal: document.getElementById('black-modal'),
                    modalText: document.getElementById('modal-text'),
                    video: document.getElementById('video-container'),
                    mainVideo: document.getElementById('main-video'),
                    typing: document.getElementById('typing-wrapper'),
                    typingText: document.getElementById('typing-text'),
                    resetBtn: document.getElementById('reset-btn')
                };

                this.messages = {
                    q2: [
                        { title: "Ÿáÿß ŸÑŸäÿ¥ÿü üò§", subtitle: "ÿ¨ÿßŸàÿ®Ÿä ÿ®ÿ≥ÿ±ÿπÿ©" },
                        { title: "ÿ£ŸÜ⁄Üÿ®Ÿä ŸÑÿßÿ≤ŸÖ ÿ™ÿ≠ÿ®ŸäŸÜŸä üòÜ", subtitle: "ŸÖÿßŸÉŸà ÿÆŸäÿßÿ± ÿ´ÿßŸÜŸä" },
                        { title: "ŸÖÿßŸÉŸà ÿ∫Ÿäÿ± ÿ™⁄ØŸàŸÑŸäŸÜ ÿ£Ÿä ü•∫", subtitle: "ŸæŸÑŸäŸäÿ≤" },
                        { title: "ÿ£ŸÜÿß ÿ£ŸÜÿ™ÿ∏ÿ±... ‚è∞", subtitle: "ŸÖÿß ÿ±ÿßÿ≠ ÿ£ÿ≥ÿ™ÿ≥ŸÑŸÖ" }
                    ],
                    q3: [
                        { title: "ÿ™ÿ±Ÿâ ÿßÿ≤ÿπŸÑ ü´§", subtitle: "ŸÅŸÉÿ±Ÿä ŸÉŸàŸäÿ≥" },
                        { title: "ÿ≤ÿπŸÑÿ™ ŸäŸÑÿß ÿ®ÿßÿßÿßŸä ü•≤üíî", subtitle: "..." },
                        { title: "ŸäŸÑÿß ⁄ØŸàŸÑŸä ÿ£Ÿä ÿ∫ÿµÿ®Ÿãÿß ÿπŸÜÿ¨ üóø", subtitle: "ÿ¢ÿÆÿ± ŸÅÿ±ÿµÿ©" }
                    ]
                };

                this.finalText = "‚ô° ŸÉŸäŸÅ ÿßŸÜÿ≥ÿßŸá ŸàÿßŸÑÿ∞ŸÉÿ±Ÿâ ÿ™ÿ§ÿ±ŸÇŸÜŸä Ÿàÿ∑ŸäŸÅÿ© ŸÅŸä Ÿàÿ¨ŸàŸá ÿßŸÑŸÜÿßÿ≥ ÿßŸÑŸÇÿßŸáŸè ÿßŸÜÿ≥Ÿâ ÿßŸÑÿ≠ŸäÿßŸá Ÿàÿ£ŸÜÿ≥Ÿâ ŸÉŸÑ ŸÖÿß ŸÅŸäŸáÿß ŸÖŸÜ ÿßŸÑŸÖÿ®ÿßŸáÿ¨ ŸÑŸÉŸÜ ŸÑÿ≥ÿ™ ÿßŸÜÿ≥ÿßŸáŸè";

                this.initEscapeMode();
            }

            initEscapeMode() {
                const btn = this.elements.q2No;
                const container = this.elements.q2;

                btn.addEventListener('mouseenter', () => {
                    if (this.escapeMode && this.currentStage === 2) {
                        this.moveButtonRandomly(btn, container);
                    }
                });

                btn.addEventListener('click', (e) => {
                    if (this.escapeMode && this.currentStage === 2) {
                        e.preventDefault();
                        this.moveButtonRandomly(btn, container);
                    }
                });
            }

            moveButtonRandomly(btn, container) {
                const containerRect = container.getBoundingClientRect();
                const btnRect = btn.getBoundingClientRect();
                
                const padding = 20;
                const maxX = containerRect.width - btnRect.width - padding * 2;
                const maxY = containerRect.height - btnRect.height - padding * 2;
                
                const randomX = Math.random() * maxX + padding;
                const randomY = Math.random() * maxY + padding;
                
                btn.style.position = 'absolute';
                btn.style.right = randomX + 'px';
                btn.style.top = randomY + 'px';
            }

            transition(from, to) {
                from.classList.add('exit');
                setTimeout(() => {
                    from.classList.remove('active', 'exit');
                    to.classList.add('active');
                }, 600);
            }

            handleQ1(answer) {
                if (answer === 'no') {
                    this.elements.modalText.textContent = 'ŸäŸÑÿß ŸÑÿπÿØ ÿßÿ™Ÿà⁄ØŸÑŸä ÿ¥ÿ¨ÿßÿ®ÿ¨ ŸáŸÜÿßÿü ü§®';
                    this.elements.modal.classList.add('active');
                } else {
                    this.particles.setMode('heart');
                    setTimeout(() => {
                        this.particles.setMode('explode');
                        setTimeout(() => {
                            this.particles.setMode('float');
                        }, 1500);
                    }, 2000);
                    
                    this.transition(this.elements.q1, this.elements.q2);
                    this.currentStage = 2;
                }
            }

            handleQ2(answer) {
                if (answer === 'yes') {
                    this.confetti.explode();
                    this.transition(this.elements.q2, this.elements.q3);
                    this.currentStage = 3;
                    this.escapeMode = false;
                } else {
                    this.q2Attempts++;
                    
                    if (this.q2Attempts >= 4) {
                        this.escapeMode = true;
                        this.elements.q2No.classList.add('escape-mode');
                    }

                    const msgIndex = Math.min(this.q2Attempts - 1, this.messages.q2.length - 1);
                    const msg = this.messages.q2[msgIndex];
                    
                    this.elements.q2Title.textContent = msg.title;
                    this.elements.q2Subtitle.textContent = msg.subtitle;
                    
                    this.elements.q2.classList.add('shake');
                    setTimeout(() => {
                        this.elements.q2.classList.remove('shake');
                    }, 500);
                }
            }

            handleQ3(answer) {
                if (answer === 'yes') {
                    this.particles.setMode('infinity');
                    setTimeout(() => {
                        this.particles.setMode('double-heart');
                        this.showFinal();
                    }, 2000);
                    
                    this.elements.q3.classList.add('exit');
                    setTimeout(() => {
                        this.elements.q3.classList.remove('active', 'exit');
                    }, 600);
                } else {
                    this.q3Attempts++;
                    
                    if (this.q3Attempts >= 3) {
                        this.elements.q3No.style.display = 'none';
                    }

                    const msgIndex = Math.min(this.q3Attempts - 1, this.messages.q3.length - 1);
                    const msg = this.messages.q3[msgIndex];
                    
                    this.elements.q3Title.textContent = msg.title;
                    this.elements.q3Subtitle.textContent = msg.subtitle;
                    
                    this.elements.q3.classList.add('shake');
                    setTimeout(() => {
                        this.elements.q3.classList.remove('shake');
                    }, 500);

                    if (this.q3Attempts === 2) {
                        document.body.style.filter = 'brightness(0.3)';
                        setTimeout(() => {
                            document.body.style.filter = 'brightness(1)';
                        }, 2000);
                    }
                }
            }

            handleModal(answer) {
                this.elements.modal.classList.remove('active');
                
                if (answer === 'no') {
                    this.reset();
                } else {
                    this.transition(this.elements.q1, this.elements.q2);
                    this.currentStage = 2;
                }
            }

            showFinal() {
                this.elements.video.classList.add('active');
                this.elements.mainVideo.play();
                
                setTimeout(() => {
                    this.elements.typing.classList.add('active');
                    this.typeText(this.finalText, () => {
                        this.elements.resetBtn.classList.add('active');
                    });
                }, 1000);
            }

            typeText(text, callback) {
                let i = 0;
                this.elements.typingText.textContent = '';
                
                const type = () => {
                    if (i < text.length) {
                        this.elements.typingText.textContent += text.charAt(i);
                        i++;
                        setTimeout(type, 60);
                    } else if (callback) {
                        callback();
                    }
                };
                
                type();
            }

            reset() {
                // Stop video
                this.elements.mainVideo.pause();
                this.elements.mainVideo.currentTime = 0;
                
                // Hide elements
                this.elements.video.classList.remove('active');
                this.elements.typing.classList.remove('active');
                this.elements.resetBtn.classList.remove('active');
                this.elements.modal.classList.remove('active');
                
                // Reset text
                this.elements.typingText.textContent = '';
                this.elements.q2Title.textContent = 'ÿ™ÿ≠ÿ®ŸäŸÜŸäÿü ü•∫';
                this.elements.q2Subtitle.textContent = 'ŸÅŸÉÿ±Ÿä ŸÉŸàŸäÿ≥ ŸÇÿ®ŸÑ ŸÖÿß ÿ™ÿ¨ÿßŸàÿ®Ÿä';
                this.elements.q3Title.textContent = 'ÿ£ÿ∫ŸÑŸâ Ÿàÿßÿ≠ÿØ ÿπŸÜÿØ⁄Ü.. üíé';
                this.elements.q3Subtitle.textContent = 'ÿ£ŸÜÿß ŸàŸÑÿß ÿ∫Ÿäÿ±Ÿäÿü';
                
                // Reset buttons
                this.elements.q2No.style.position = '';
                this.elements.q2No.style.right = '';
                this.elements.q2No.style.top = '';
                this.elements.q2No.classList.remove('escape-mode');
                this.elements.q3No.style.display = '';
                
                // Reset state
                this.currentStage = 1;
                this.q2Attempts = 0;
                this.q3Attempts = 0;
                this.escapeMode = false;
                
                // Reset particles
                this.particles.setMode('float');
                
                // Show Q1
                this.elements.q2.classList.remove('active');
                this.elements.q3.classList.remove('active');
                this.elements.q1.classList.add('active');
            }
        }

        // Initialize
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
                window.app = new ZozoApp();
            }, 1000);
        });
    </script>
</body>
    </html>
